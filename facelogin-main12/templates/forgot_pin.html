{% extends "layout.html" %}
{% block title %} Forgot Safe PIN {% endblock %}
{% block main %}
<div class="mainforgot" style="width: 400px; background: white; height: 400px; box-shadow: 5px 7px 15px rgba(0, 0, 0, 0.5); border-radius: 40px; padding: 20px; transition: transform 0.3s; position: relative;">
    <h3 style="text-align: center;">Forgot Safe PIN</h3>
    <p>Enter your username and set a new Safe PIN.</p>
    <form id="forgotPinForm" action="/forgot_pin" method="POST">
        <div class="form-group">
            <input class="form-control" name="username" placeholder="üóí Enter Registered Username" type="text" required />
        </div>
        <div class="form-group">
            <input class="form-control" name="new_pin" placeholder="üîë New Safe PIN" type="password" required />
        </div>
        <div class="form-group">
            <input class="form-control" name="confirm_pin" placeholder="üîë Confirm Safe PIN" type="password" required />
        </div>
        <button class="btn btn-success" type="submit">Reset PIN</button>
        <p id="error-message" style="color: red; text-align: center;"></p>
    </form>
    <div id="emojiContainer" style="text-align: center; margin-top: 10px;">
        <span id="successEmoji" class="emoji" style="display: none;">ü§´</span> <!-- Shhh emoji -->
        <span id="errorEmoji" class="emoji" style="display: none;">üôÖ‚Äç‚ôÇÔ∏è</span> <!-- No emoji -->
    </div>
</div>

<style>
    .mainforgot {
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .mainforgot:hover {
        transform: scale(1.05); /* Slightly enlarge the form */
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5); /* Increase shadow on hover */
    }

    .form-control {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border: 2px solid #ccc;
        border-radius: 10px;
        transition: border-color 0.3s;
    }

    .form-control:focus {
        border-color: #28a745; /* Change border color on focus */
        outline: none; /* Remove default outline */
    }

    .btn-success {
        width: 100%;
        padding: 12px;
        font-size: 18px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 10px;
        margin-top: 10px;
        cursor: pointer;
        transition: background 0.3s, transform 0.3s;
    }

    .btn-success:hover {
        background: #218838; /* Darker green on hover */
        transform: scale(1.05); /* Slightly enlarge the button */
    }

    .emoji {
        font-size: 50px; /* Adjust emoji size */
        margin-top: 10px; /* Space above emoji */
        display: none; /* Initially hidden */
        animation: move 1s infinite alternate; /* Add move animation */
    }

    @keyframes move {
        0% {
            transform: translateX(-50px); /* Start from left */
        }
        100% {
            transform: translateX(50px); /* Move to right */
        }
    }
</style>

<script>
document.getElementById("forgotPinForm").addEventListener("submit", function(event) {
    event.preventDefault();
    
    const form = this;
    const formData = new FormData(form);
    const successEmoji = document.getElementById("successEmoji");
    const errorEmoji = document.getElementById("errorEmoji");
    const errorMessage = document.getElementById("error-message");

    // Clear previous messages and emojis
    errorMessage.textContent = '';
    successEmoji.style.display = 'none';
    errorEmoji.style.display = 'none';

    fetch(form.action, {
        method: form.method,
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            successEmoji.style.display = 'inline'; // Show success emoji
            setTimeout(() => {
                alert(data.message); // Show success message
                window.location.href = data.redirect; // Redirect after a short delay
            }, 1000 ); // Delay for 1 second to show emoji
        } else {
            errorMessage.textContent = data.message;
            errorEmoji.style.display = 'inline'; // Show error emoji
        }
    })
    .catch(error => {
        console.error("Error:", error);
        errorMessage.textContent = "An error occurred. Please try again.";
        errorEmoji.style.display = 'inline'; // Show error emoji
    });
});
</script>
{% endblock %}